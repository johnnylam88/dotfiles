#!/bin/sh

script=${0##*/}
git="git"
repo_path="${HOME}/.home"
dotkeeper="$git"' --git-dir='"${repo_path}"' --work-tree='"${HOME}"

case "${1}" in
help)
	echo "Usage: ${script} help"
	echo "       ${script} init"
	echo "       ${script} clone <remote-git-repo-url>"
	echo "       ${script} vcs subcommand [option ...]"
	exit 0
	;;

init)
	if [ -d "${repo_path}" ]; then
		echo 1>&2 "${script}: path already exists \`${repo_path}'"
		exit 2
	fi
	${git} init --bare="${repo_path}"
	;;

clone)
	if [ -d "${repo_path}" ]; then
		echo 1>&2 "${script}: path already exists \`${repo_path}'"
		exit 2
	fi
	shift
	if [ $# -eq 0 ]; then
		echo 1>&2 "${script}: missing repository URL"
		echo 1>&2 "Usage: ${script} clone <remote-git-repo-url>"
		exit 3
	fi
	${git} clone --bare "${1}" "${repo_path}" &&
	${dotkeeper} config --local status.showUntrackedFiles no &&
	${dotkeeper} checkout
	;;

vcs)
	if [ ! -d "${repo_path}" ]; then
		echo 1>&2 "${script}: path does not exist \`${repo_path}'"
		exit 3
	fi
	shift
	${dotkeeper} "$@"
	;;

*)
	echo 1>&2 "${script}: unknown action \`${1}'"
	exit 1
	;;
esac
